<?xml version="1.0"?>
<sdf version="1.9">
  <world name="parobot_world">

    <!-- ===================== CORE SYSTEM PLUGINS ===================== -->
    <plugin filename="gz-sim-physics-system"
            name="gz::sim::systems::Physics"/>
    <plugin filename="gz-sim-scene-broadcaster-system"
            name="gz::sim::systems::SceneBroadcaster"/>
    <plugin filename="gz-sim-sensors-system"
            name="gz::sim::systems::Sensors">
      <render_engine>ogre2</render_engine>
    </plugin>

    <!-- ===================== GROUND PLANE ===================== -->
    <model name="ground_plane">
      <static>true</static>
      <link name="link">
        <collision name="collision">
          <geometry>
            <plane>
              <normal>0 0 1</normal>
              <size>20 20</size>
            </plane>
          </geometry>
        </collision>
        <visual name="visual">
          <geometry>
            <plane>
              <normal>0 0 1</normal>
              <size>20 20</size>
            </plane>
          </geometry>
          <material>
            <ambient>0.5 0.5 0.5 1</ambient>
            <diffuse>0.5 0.5 0.5 1</diffuse>
          </material>
        </visual>
      </link>
    </model>

    <!-- ===================== LIGHT ===================== -->
    <light name="sun" type="directional">
      <cast_shadows>true</cast_shadows>
      <pose>0 0 10 0 0 0</pose>
      <diffuse>0.8 0.8 0.8 1</diffuse>
      <specular>0.1 0.1 0.1 1</specular>
      <direction>-0.5 0.5 -1</direction>
    </light>

            <!-- ===================== ROOM WALLS (SMALLER ROOM) ===================== -->
    <!-- Room is roughly 6m x 6m centered at (0,0): walls at x,y = ±3 -->

    <!-- North wall (y = +3) -->
    <model name="wall_north">
      <static>true</static>
      <pose>0 3 1 0 0 0</pose> <!-- center at z=1 -> 2m tall wall -->
      <link name="wall">
        <collision name="collision">
          <geometry>
            <box>
              <size>6 0.2 2</size> <!-- length x thickness x height -->
            </box>
          </geometry>
        </collision>
        <visual name="visual">
          <geometry>
            <box>
              <size>6 0.2 2</size>
            </box>
          </geometry>
          <material>
            <ambient>0.6 0.6 0.7 1</ambient>
            <diffuse>0.6 0.6 0.7 1</diffuse>
          </material>
        </visual>
      </link>
    </model>

    <!-- South wall (y = -3) -->
    <model name="wall_south">
      <static>true</static>
      <pose>0 -3 1 0 0 0</pose>
      <link name="wall">
        <collision name="collision">
          <geometry>
            <box>
              <size>6 0.2 2</size>
            </box>
          </geometry>
        </collision>
        <visual name="visual">
          <geometry>
            <box>
              <size>6 0.2 2</size>
            </box>
          </geometry>
          <material>
            <ambient>0.6 0.6 0.7 1</ambient>
            <diffuse>0.6 0.6 0.7 1</diffuse>
          </material>
        </visual>
      </link>
    </model>

    <!-- East wall (x = +3) -->
    <model name="wall_east">
      <static>true</static>
      <pose>3 0 1 0 0 1.5708</pose> <!-- rotated 90deg -->
      <link name="wall">
        <collision name="collision">
          <geometry>
            <box>
              <size>6 0.2 2</size>
            </box>
          </geometry>
        </collision>
        <visual name="visual">
          <geometry>
            <box>
              <size>6 0.2 2</size>
            </box>
          </geometry>
          <material>
            <ambient>0.6 0.6 0.7 1</ambient>
            <diffuse>0.6 0.6 0.7 1</diffuse>
          </material>
        </visual>
      </link>
    </model>

    <!-- West wall (x = -3) -->
    <model name="wall_west">
      <static>true</static>
      <pose>-3 0 1 0 0 1.5708</pose>
      <link name="wall">
        <collision name="collision">
          <geometry>
            <box>
              <size>6 0.2 2</size>
            </box>
          </geometry>
        </collision>
        <visual name="visual">
          <geometry>
            <box>
              <size>6 0.2 2</size>
            </box>
          </geometry>
          <material>
            <ambient>0.6 0.6 0.7 1</ambient>
            <diffuse>0.6 0.6 0.7 1</diffuse>
          </material>
        </visual>
      </link>
    </model>

    <!-- ===================== OBSTACLES (DENSER FIELD) ===================== -->

    <!-- Near front-right -->
    <model name="obstacle1">
      <static>true</static>
      <pose>1.3 1.0 0.25 0 0 0</pose>
      <link name="box">
        <collision name="collision">
          <geometry>
            <box>
              <size>0.5 0.8 0.5</size>
            </box>
          </geometry>
        </collision>
        <visual name="visual">
          <geometry>
            <box>
              <size>0.5 0.8 0.5</size>
            </box>
          </geometry>
          <material>
            <ambient>0.8 0.2 0.2 1</ambient>
            <diffuse>0.8 0.2 0.2 1</diffuse>
          </material>
        </visual>
      </link>
    </model>

    <!-- Near front-left -->
    <model name="obstacle2">
      <static>true</static>
      <pose>-1.4 1.2 0.25 0 0 0</pose>
      <link name="box">
        <collision name="collision">
          <geometry>
            <box>
              <size>0.8 0.4 0.5</size>
            </box>
          </geometry>
        </collision>
        <visual name="visual">
          <geometry>
            <box>
              <size>0.8 0.4 0.5</size>
            </box>
          </geometry>
          <material>
            <ambient>0.2 0.8 0.2 1</ambient>
            <diffuse>0.2 0.8 0.2 1</diffuse>
          </material>
        </visual>
      </link>
    </model>

    <!-- Back-left -->
    <model name="obstacle3">
      <static>true</static>
      <pose>-1.5 -1.3 0.25 0 0 0</pose>
      <link name="box">
        <collision name="collision">
          <geometry>
            <box>
              <size>0.7 0.7 0.5</size>
            </box>
          </geometry>
        </collision>
        <visual name="visual">
          <geometry>
            <box>
              <size>0.7 0.7 0.5</size>
            </box>
          </geometry>
          <material>
            <ambient>0.2 0.2 0.8 1</ambient>
            <diffuse>0.2 0.2 0.8 1</diffuse>
          </material>
        </visual>
      </link>
    </model>

    <!-- Back-right -->
    <model name="obstacle4">
      <static>true</static>
      <pose>1.6 -1.4 0.25 0 0 0</pose>
      <link name="box">
        <collision name="collision">
          <geometry>
            <box>
              <size>0.6 0.6 0.5</size>
            </box>
          </geometry>
        </collision>
        <visual name="visual">
          <geometry>
            <box>
              <size>0.6 0.6 0.5</size>
            </box>
          </geometry>
          <material>
            <ambient>0.8 0.8 0.2 1</ambient>
            <diffuse>0.8 0.8 0.2 1</diffuse>
          </material>
        </visual>
      </link>
    </model>

    <!-- Small pillar near right wall -->
    <model name="obstacle5">
      <static>true</static>
      <pose>2.4 0.3 0.3 0 0 0</pose>
      <link name="box">
        <collision name="collision">
          <geometry>
            <box>
              <size>0.4 0.4 0.6</size>
            </box>
          </geometry>
        </collision>
        <visual name="visual">
          <geometry>
            <box>
              <size>0.4 0.4 0.6</size>
            </box>
          </geometry>
          <material>
            <ambient>0.2 0.8 0.8 1</ambient>
            <diffuse>0.2 0.8 0.8 1</diffuse>
          </material>
        </visual>
      </link>
    </model>

    <!-- Small pillar near left wall -->
    <model name="obstacle6">
      <static>true</static>
      <pose>-2.3 -0.2 0.3 0 0 0</pose>
      <link name="box">
        <collision name="collision">
          <geometry>
            <box>
              <size>0.4 0.4 0.6</size>
            </box>
          </geometry>
        </collision>
        <visual name="visual">
          <geometry>
            <box>
              <size>0.4 0.4 0.6</size>
            </box>
          </geometry>
          <material>
            <ambient>0.8 0.4 0.8 1</ambient>
            <diffuse>0.8 0.4 0.8 1</diffuse>
          </material>
        </visual>
      </link>
    </model>

    <!-- ===================== PAROBOT MODEL ===================== -->
    <model name="parobot">
      <pose>0 0 0 0 0 0</pose>
      <static>false</static>

      <!-- ---------- Chassis ---------- -->
      <link name="base_link">
        <pose>0 0 0.12 0 0 0</pose>
        <inertial>
          <mass>5.0</mass>
          <inertia>
            <ixx>0.1</ixx><ixy>0.0</ixy><ixz>0.0</ixz>
            <iyy>0.1</iyy><iyz>0.0</iyz>
            <izz>0.1</izz>
          </inertia>
        </inertial>

        <collision name="collision">
          <geometry>
            <box>
              <size>0.4 0.3 0.2</size>
            </box>
          </geometry>
        </collision>

        <visual name="visual">
          <geometry>
            <box>
              <size>0.4 0.3 0.2</size>
            </box>
          </geometry>
          <material>
            <ambient>0.1 0.3 0.8 1</ambient>
            <diffuse>0.1 0.3 0.8 1</diffuse>
          </material>
        </visual>

        <!-- LiDAR sensor -->
        <sensor name="lidar" type="gpu_lidar">
          <pose>0.15 0 0.18 0 0 0</pose>
          <topic>lidar</topic>
          <update_rate>10</update_rate>
          <ray>
            <scan>
              <horizontal>
                <samples>720</samples>
                <resolution>1</resolution>
                <min_angle>-3.14159</min_angle>
                <max_angle> 3.14159</max_angle>
              </horizontal>
              <vertical>
                <samples>1</samples>
                <resolution>1</resolution>
                <min_angle>0</min_angle>
                <max_angle>0</max_angle>
              </vertical>
            </scan>
            <range>
              <min>0.1</min>
              <max>8.0</max>
              <resolution>0.01</resolution>
            </range>
          </ray>
          <always_on>1</always_on>
          <visualize>true</visualize>
        </sensor>
      </link>

      <!-- ---------- Left wheel ---------- -->
      <link name="left_wheel">
        <!-- Position relative to model (parobot) -->
        <pose>0 0.15 0.06 0 0 0</pose>
        <inertial>
          <mass>0.5</mass>
          <inertia>
            <ixx>0.01</ixx><ixy>0.0</ixy><ixz>0.0</ixz>
            <iyy>0.01</iyy><iyz>0.0</iyz>
            <izz>0.01</izz>
          </inertia>
        </inertial>

        <!-- Collision: cylinder rotated 90° around X so axis is Y -->
        <collision name="collision">
          <pose>0 0 0 1.5708 0 0</pose>
          <geometry>
            <cylinder>
              <radius>0.06</radius>
              <length>0.03</length>
            </cylinder>
          </geometry>
          <surface>
            <friction>
              <ode>
                <mu>1.0</mu>
                <mu2>1.0</mu2>
              </ode>
            </friction>
          </surface>
        </collision>

        <!-- Main wheel visual -->
        <visual name="visual">
          <pose>0 0 0 1.5708 0 0</pose>
          <geometry>
            <cylinder>
              <radius>0.06</radius>
              <length>0.03</length>
            </cylinder>
          </geometry>
          <material>
            <ambient>0.05 0.05 0.05 1</ambient>
            <diffuse>0.05 0.05 0.05 1</diffuse>
          </material>
        </visual>

        <!-- Spoke line so you can see rotation -->
        <visual name="spoke">
          <pose>0 0 0 1.5708 0 0</pose>
          <geometry>
            <!-- A thin bar across the wheel -->
            <box>
              <size>0.12 0.005 0.01</size>
            </box>
          </geometry>
          <material>
            <ambient>0.9 0.9 0.2 1</ambient>
            <diffuse>0.9 0.9 0.2 1</diffuse>
          </material>
        </visual>
      </link>

      <!-- ---------- Right wheel ---------- -->
      <link name="right_wheel">
        <pose>0 -0.15 0.06 0 0 0</pose>
        <inertial>
          <mass>0.5</mass>
          <inertia>
            <ixx>0.01</ixx><ixy>0.0</ixy><ixz>0.0</ixz>
            <iyy>0.01</iyy><iyz>0.0</iyz>
            <izz>0.01</izz>
          </inertia>
        </inertial>

        <collision name="collision">
          <pose>0 0 0 1.5708 0 0</pose>
          <geometry>
            <cylinder>
              <radius>0.06</radius>
              <length>0.03</length>
            </cylinder>
          </geometry>
          <surface>
            <friction>
              <ode>
                <mu>1.0</mu>
                <mu2>1.0</mu2>
              </ode>
            </friction>
          </surface>
        </collision>

        <visual name="visual">
          <pose>0 0 0 1.5708 0 0</pose>
          <geometry>
            <cylinder>
              <radius>0.06</radius>
              <length>0.03</length>
            </cylinder>
          </geometry>
          <material>
            <ambient>0.05 0.05 0.05 1</ambient>
            <diffuse>0.05 0.05 0.05 1</diffuse>
          </material>
        </visual>

        <visual name="spoke">
          <pose>0 0 0 1.5708 0 0</pose>
          <geometry>
            <box>
              <size>0.12 0.005 0.01</size>
            </box>
          </geometry>
          <material>
            <ambient>0.9 0.9 0.2 1</ambient>
            <diffuse>0.9 0.9 0.2 1</diffuse>
          </material>
        </visual>
      </link>

      <!-- ---------- Wheel joints (NO EXTRA POSE HERE) ---------- -->
      <joint name="left_wheel_joint" type="revolute">
        <parent>base_link</parent>
        <child>left_wheel</child>
        <!-- Joint at the wheel link origin, so no extra offset -->
        <pose>0 0 0 0 0 0</pose>
        <axis>
          <!-- Rotate about Y so wheel rolls along X -->
          <xyz>0 1 0</xyz>
          <limit>
            <lower>-1e16</lower>
            <upper> 1e16</upper>
          </limit>
        </axis>
      </joint>

      <joint name="right_wheel_joint" type="revolute">
        <parent>base_link</parent>
        <child>right_wheel</child>
        <pose>0 0 0 0 0 0</pose>
        <axis>
          <xyz>0 1 0</xyz>
          <limit>
            <lower>-1e16</lower>
            <upper> 1e16</upper>
          </limit>
        </axis>
      </joint>

            <!-- ---------- Diff drive plugin ---------- -->
      <plugin filename="gz-sim-diff-drive-system"
              name="gz::sim::systems::DiffDrive">

        <left_joint>left_wheel_joint</left_joint>
        <right_joint>right_wheel_joint</right_joint>

        <wheel_separation>0.3</wheel_separation>
        <wheel_radius>0.06</wheel_radius>

        <!-- ✅ Use simple, global topic names -->
        <topic>/cmd_vel</topic>
        <odom_topic>/odometry</odom_topic>

        <!-- Frames (only for TF, not motion) -->
        <frame_id>odom</frame_id>
        <child_frame_id>base_link</child_frame_id>
        <odom_publish_frequency>20</odom_publish_frequency>

        <max_linear_velocity>2.0</max_linear_velocity>
        <max_angular_velocity>4.0</max_angular_velocity>
      </plugin>


    </model>

  </world>
</sdf>
